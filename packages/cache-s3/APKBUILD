# Contributor: Markus Schirp <mbj@schirp-dso.com>
# Maintainer: Markus Schirp <mbj@schirp-dso.com>
arch=x86_64
gitref=52ae9a6350338ddb53d5ee30c0ffeb6523e7f1b9
license=BSD-3-Clause
makedepends="ghc=8.6.5-r3 stack>=2.3.1 zlib-dev zlib-static"
pkgdesc='Utility to cache stack state on S3'
pkgname=cache-s3
pkgrel=0
pkgver=0.1.10
dirname="cache-s3-$gitref"
filename="$gitref.tar.gz"
source="https://github.com/mbj/cache-s3/archive/$filename"
url=https://www.haskellstack.org

build() {
  cd "$srcdir/$dirname"

  stack build                 \
    --copy-bins               \
    --flag cache-s3:static    \
    --local-bin-path "$(pwd)" \
    --system-ghc
}

check() {
  "$srcdir/$dirname/cache-s3" --version
}

package() {
  cd "$srcdir/$dirname"
  install -Dm755 -- cache-s3 "$pkgdir/usr/bin/cache-s3"
}

sha256sums="29fe06aa47e8b75afbd0c51f4becb63c7c4be9899839ac46755d76b56cd48892  $filename"
